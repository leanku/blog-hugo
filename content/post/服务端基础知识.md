---
title: "服务端基础知识"
date: 2022-12-17T21:46:01+08:00
draft: false
categories: ["服务端"]
tags: ["服务端","TCP","网络模型","三次握手"]
keywords: ["服务端"]
---

# OSI七层模型

|层|作用|注
|:--|:--|:--|
|应用层 |为程序提供服务|规范数据格式|
|表示层 |数据格式转换，加密|翻译|
|会话层 |建立和管理会话|没有指定协议|
|传输层 |管理端到端之间的连接|TCP协议、UDP协议|
|网络层 |IP地址和路由|IP地址、ARP协议|
|数据链路层 |链路管理|MAC地址、帧|
|物理层 |提供传输环境|网线、WiFi|

<br>

# TCP/IP四层模型
|层|包含
|:--|:--|
|应用层 |应用层、表示层、会话层|
|传输层 |传输层|
|网络层 |网络层|
|数据链路层 |数据链路层、物理层|
<br>

# ARP协议
> 地址解析协议，即ARP（Address Resolution Protocol），是根据IP地址获取物理地址的一个TCP/IP协议。主机发送信息时将包含目标IP地址的ARP请求广播到局域网络上的所有主机，并接收返回消息，以此确定目标的物理地址；收到返回消息后将该IP地址和物理地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源。地址解析协议是建立在网络中各个主机互相信任的基础上的，局域网络上的主机可以自主发送ARP应答消息，其他主机收到应答报文时不会检测该报文的真实性就会将其记入本机ARP缓存；由此攻击者就可以向某一主机发送伪ARP应答报文，使其发送的信息无法到达预期的主机或到达错误的主机，这就构成了一个ARP欺骗。ARP命令可用于查询本机ARP缓存中IP地址和MAC地址的对应关系、添加或删除静态对应关系等。相关协议有RARP、代理ARP。NDP用于在IPv6中代替地址解析协议。

<br>

# TCP/UDP协议
>TCP和UDP协议是TCP/IP协议的核心。 TCP 传输协议：TCP 协议是一TCP (Transmission Control Protocol)和UDP(User Datagram Protocol)协议属于传输层协议。其中TCP提供IP环境下的数据可靠传输，它提供的服务包括数据流传送、可靠性、有效流控、全双工操作和多路复用。通过面向连接、端到端和可靠的数据包发送。通俗说，它是事先为所发送的数据开辟出连接好的通道，然后再进行数据发送；而UDP则不为IP提供可靠性、流控或差错恢复功能。一般来说，TCP对应的是可靠性要求高的应用，而UDP对应的则是可靠性要求低、传输经济的应用

<br>

# TCP三次握手
>所谓的“三次握手”：为了对每次发送的数据量进行跟踪与协商，确保数据段的发送和接收同步，根据所接收到的数据量而确认数据发送、接收完毕后何时撤消联系，并建立虚连接。 
>为了提供可靠的传送，TCP在发送新的数据之前，以特定的顺序将数据包的序号，并需要这些包传送给目标机之后的确认消息。TCP总是用来发送大批量的数据。当应用程序在收到数据后要做出确认时也要用到TCP。<br>
>过程
>第一次握手：建立连接时，客户端发送syn包（seq=j）到服务器，并进入SYN_SENT状态，等待服务器确认；SYN：同步序列编号（Synchronize Sequence Numbers）。<br>
>第二次握手：服务器收到syn包，必须确认客户端的SYN（ack=j+1），同时自己也发送一个SYN包（seq=k），即SYN+ACK包，此时服务器进入SYN_RECV状态。<br>
>第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=k+1)，此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，完成三次握手。<br>
>完成三次握手，客户端与服务器开始传送数据（可使用抓包工具tcpdump 命令 tcpdump -nn -i eth0 prot 80）

<br>

# TCP四次挥手
>对于一个已经建立的连接，TCP使用改进的四次挥手来释放连接（使用一个带有FIN附加标记的报文段）。TCP关闭连接的步骤如下： <br>
>第一步，当主机A的应用程序通知TCP数据已经发送完毕时，TCP向主机B发送一个带有FIN附加标记的报文段（FIN表示英文finish）。 <br>
>第二步，主机B收到这个FIN报文段之后，并不立即用FIN报文段回复主机A，而是先向主机A发送一个确认序号ACK，同时通知自己相应的应用程序：对方要求关闭连接（先发送ACK的目的是为了防止在这段时间内，对方重传FIN报文段）。<br>
>第三步，主机B的应用程序告诉TCP：我要彻底的关闭连接，TCP向主机A送一个FIN报文段。<br>
>第四步，主机A收到这个FIN报文段后，向主机B发送一个ACK表示连接彻底释放。<br>

<br>

# TCP和UDP的区别
|特征|TCP|UDP
|:--|:--|:--|
|是否链接 |面向链接|面向非链接|
|传输可靠性 |可靠|不可靠|
|应用场景 |传输数据量大|传输数据量小|
|速度 |慢|快|
<br>